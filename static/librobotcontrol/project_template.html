<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Robot Control Library: Project Template</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Robot Control Library"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Robot Control Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('project_template.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Project Template </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#template_s1">Copying the Template</a><ul><li class="level2"><a href="#template_s1s1">Make a Copy</a></li>
<li class="level2"><a href="#template_s1s2">Modify the Project Name</a></li>
</ul>
</li>
<li class="level1"><a href="#template_s2">Using the Makefile</a><ul><li class="level2"><a href="#template_s2s1">make (to compile)</a></li>
<li class="level2"><a href="#template_s2s2">make clean</a></li>
<li class="level2"><a href="#template_s2s3">make install</a></li>
<li class="level2"><a href="#template_s2s4">make uninstall</a></li>
<li class="level2"><a href="#template_s2s5">make runonboot</a></li>
</ul>
</li>
<li class="level1"><a href="#template_s3">Structure of the Project Template</a></li>
</ul>
</div>
<div class="textblock"><p>We highly suggest using or at least studying the rc_project_template available at <a href="https://github.com/StrawsonDesign/librobotcontrol/tree/master/rc_project_template">https://github.com/StrawsonDesign/librobotcontrol/tree/master/rc_project_template</a>.</p>
<h1><a class="anchor" id="template_s1"></a>
Copying the Template</h1>
<p>The project template source is also included as part of the librobotcontrol package and in installed to /usr/share/robotcontrol/rc_project_template so it can be easily copied and modified. We suggest copying the project and modifying as follows.</p>
<h2><a class="anchor" id="template_s1s1"></a>
Make a Copy</h2>
<p>Make a copy of the project template, rename the folder to your desired project name, and cd to your new directory.</p>
<div class="fragment"><div class="line">cp -r /usr/share/robotcontrol/rc_project_template ~/new_project_name</div><div class="line">cd new_project_name</div></div><!-- fragment --><h2><a class="anchor" id="template_s1s2"></a>
Modify the Project Name</h2>
<p>Change the name of the C source code file to match your project name. Now edit the makefile so it knows to compile the new C file. It will also produce a compiled executable with this new name.</p>
<div class="fragment"><div class="line">mv rc_project_template.c new_project_name.c</div><div class="line">nano Makefile</div></div><!-- fragment --><p>For now, you should only need to change the TARGET variable of the Makefile to match your project. As your project grows you may need to edit this Makefile further as required for your needs.</p>
<div class="fragment"><div class="line"><span class="preprocessor"># This is a general use makefile for librobotcontrol projects written in C.</span></div><div class="line"><span class="preprocessor"># Just change the target name to match your main source code filename.</span></div><div class="line">TARGET = new_project_name</div><div class="line"></div><div class="line"><span class="preprocessor"># compiler and linker binaries</span></div><div class="line">CC              := gcc</div><div class="line">LINKER          := gcc</div><div class="line">.</div><div class="line">.</div><div class="line">.</div></div><!-- fragment --><h1><a class="anchor" id="template_s2"></a>
Using the Makefile</h1>
<p>For those unfamiliar with 'make' and Makefiles, 'make' is a mature and well-documented build tool for compiling source code. If you are interested, lots of good information about the make tool can be found at <a href="https://www.gnu.org/software/make/manual/html_node/Introduction.html">https://www.gnu.org/software/make/manual/html_node/Introduction.html</a>.</p>
<p>To save the user the time and effort of learning how to create Makefiles, this template contains a simple and generic Makefile which links to the librobotcontrol library and provides the following common make commands:</p>
<div class="fragment"><div class="line">make</div><div class="line">make clean</div><div class="line">make install</div><div class="line">make uninstall</div><div class="line">make runonboot</div></div><!-- fragment --><h2><a class="anchor" id="template_s2s1"></a>
make (to compile)</h2>
<p>This will use gcc to compile the C file you renamed in section 1 and will produce an executable with the same name, but without the '.c' extention. Part of the process is linking this executable to the librobotcontrol shared object. For convenience it also links to the 'math' and 'pthread' libraries as these are most common. It can be easily modified to link to other libraries by adding to the 'LDFLAGS' list in the Makefile.</p>
<h2><a class="anchor" id="template_s2s2"></a>
make clean</h2>
<p>As part of compiling and building process, a '.o' object file was also created along with the final executable. If you are making a backup of your project source files, or are pushing your progress up to a git repository (as you should!!) then it's helpful to clean up these compiled binary files. Executing 'make clean' in your project source directory will clean up these binary files leaving only the source code.</p>
<h2><a class="anchor" id="template_s2s3"></a>
make install</h2>
<p>Normally you would execute your newly-compiled executable from within the same directory that it exists. For example, compiling and executing the project template would look like this:</p>
<div class="fragment"><div class="line">debian@beaglebone:~$ cd ../rc_project_template/</div><div class="line">debian@beaglebone:~/rc_project_template$ make</div><div class="line">Made: rc_project_template</div><div class="line">debian@beaglebone:~/rc_project_template$ ./rc_project_template</div><div class="line">running...</div></div><!-- fragment --><p>Once you are satisfied with the functionality of your new program, you will want to install the executable in a place where it can be run from anywhere for easy access in the future. This location is typically '/usr/local/bin/' for executables made locally by users. Instead of making a copy there manually, the 'make install' command will do this for you. You will have to use 'sudo' as the '/usr/' directory has restricted privileges.</p>
<div class="fragment"><div class="line">debian@beaglebone:~/rc_project_template$ sudo make install</div><div class="line">debian@beaglebone:~/rc_project_template$ cd ../</div><div class="line">debian@beaglebone:~$ rc_project_template</div><div class="line">running...</div></div><!-- fragment --><h2><a class="anchor" id="template_s2s4"></a>
make uninstall</h2>
<p>'make uninstall' simply deletes the copy of your current project executable from '/usr/local/bin/'. It will not delete your source files.</p>
<h2><a class="anchor" id="template_s2s5"></a>
make runonboot</h2>
<p>This 'runonboot' command is unique to the Makefile provided in the project template, whereas 'clean' 'install' and 'uninstall' are pretty much universal amongst other Makefiles. This command sets the program to run automatically on boot if the robotcontrol systemd service is enabled, see the <a href="runonboot.html">Run on Boot section</a> for more details.</p>
<h1><a class="anchor" id="template_s3"></a>
Structure of the Project Template</h1>
<p>Instead of try to explain how the template works line-by-line, we've tried to comment the code as informatively as possible. The complete C file is included here for easy access. We encourage the user to read it carefully to understand the structure.</p>
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @file rc_project_template.c</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This is meant to be a skeleton program for Robot Control projects. Change</span></div><div class="line"><span class="comment"> * this description and file name before modifying for your own purpose.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="robotcontrol_8h.html">robotcontrol.h</a>&gt;</span> <span class="comment">// includes ALL Robot Control subsystems</span></div><div class="line"></div><div class="line"><span class="comment">// function declarations</span></div><div class="line"><span class="keywordtype">void</span> on_pause_press();</div><div class="line"><span class="keywordtype">void</span> on_pause_release();</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * This template contains these critical components</span></div><div class="line"><span class="comment"> * - ensure no existing instances are running and make new PID file</span></div><div class="line"><span class="comment"> * - start the signal handler</span></div><div class="line"><span class="comment"> * - initialize subsystems you wish to use</span></div><div class="line"><span class="comment"> * - while loop that checks for EXITING condition</span></div><div class="line"><span class="comment"> * - cleanup subsystems at the end</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @return     0 during normal operation, -1 on error</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">        <span class="comment">// make sure another instance isn&#39;t running</span></div><div class="line">        <span class="comment">// if return value is -3 then a background process is running with</span></div><div class="line">        <span class="comment">// higher privaledges and we couldn&#39;t kill it, in which case we should</span></div><div class="line">        <span class="comment">// not continue or there may be hardware conflicts. If it returned -4</span></div><div class="line">        <span class="comment">// then there was an invalid argument that needs to be fixed.</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__start__stop.html#gac636ff375209b0261865875e168af8f6">rc_kill_existing_process</a>(2.0)&lt;-2) <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">        <span class="comment">// start signal handler so we can exit cleanly</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__start__stop.html#gaafc5000de8ff00ed83848ef29981ffc9">rc_enable_signal_handler</a>()==-1){</div><div class="line">                fprintf(stderr,<span class="stringliteral">&quot;ERROR: failed to start signal handler\n&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// initialize pause button</span></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group___button.html#ga41f81ca0e9540e20108aef704ecf9b27">rc_button_init</a>(<a class="code" href="group___button.html#ga113e5457cf1411e79c4d71bce30208f4">RC_BTN_PIN_PAUSE</a>, <a class="code" href="group___button.html#gad2b3429314eca389f651f0dbc73a7e65">RC_BTN_POLARITY_NORM_HIGH</a>,</div><div class="line">                                                <a class="code" href="group___button.html#gac2886e480777eb0ce0baecd2e5592dab">RC_BTN_DEBOUNCE_DEFAULT_US</a>)){</div><div class="line">                fprintf(stderr,<span class="stringliteral">&quot;ERROR: failed to initialize pause button\n&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Assign functions to be called when button events occur</span></div><div class="line">        <a class="code" href="group___button.html#ga4bf2fefee3bfa0bf1bbe397e1364084f">rc_button_set_callbacks</a>(<a class="code" href="group___button.html#ga113e5457cf1411e79c4d71bce30208f4">RC_BTN_PIN_PAUSE</a>,on_pause_press,on_pause_release);</div><div class="line"></div><div class="line">        <span class="comment">// make PID file to indicate your project is running</span></div><div class="line">        <span class="comment">// due to the check made on the call to rc_kill_existing_process() above</span></div><div class="line">        <span class="comment">// we can be fairly confident there is no PID file already and we can</span></div><div class="line">        <span class="comment">// make our own safely.</span></div><div class="line">        <a class="code" href="group__start__stop.html#ga855a2fced34e4dfaaea9cb6a2bc7fc07">rc_make_pid_file</a>();</div><div class="line"></div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;\nPress and release pause button to turn green LED on and off\n&quot;</span>);</div><div class="line">        printf(<span class="stringliteral">&quot;hold pause button down for 2 seconds to exit\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Keep looping until state changes to EXITING</span></div><div class="line">        <a class="code" href="group__start__stop.html#ga693e5b9f051bb14507d1d9eb246f616e">rc_set_state</a>(<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a>);</div><div class="line">        <span class="keywordflow">while</span>(<a class="code" href="group__start__stop.html#ga08307c9805692eb084112cbcae4b744f">rc_get_state</a>()!=<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9acfb2a43c3a1dfa5961655a52e11c5d73">EXITING</a>){</div><div class="line">                <span class="comment">// do things based on the state</span></div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group__start__stop.html#ga08307c9805692eb084112cbcae4b744f">rc_get_state</a>()==<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a>){</div><div class="line">                        <a class="code" href="group___l_e_d.html#ga20951fe9916766c41ee7e54a051de2eb">rc_led_set</a>(<a class="code" href="group___l_e_d.html#gga2f019f99f0f9379dd8a677d3f017baf4a0fe05d887f93787380fb76940ca52a58">RC_LED_GREEN</a>, 1);</div><div class="line">                        <a class="code" href="group___l_e_d.html#ga20951fe9916766c41ee7e54a051de2eb">rc_led_set</a>(<a class="code" href="group___l_e_d.html#gga2f019f99f0f9379dd8a677d3f017baf4acae9eba589c2aeeb09fa1f10dd7daed0">RC_LED_RED</a>, 0);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span>{</div><div class="line">                        <a class="code" href="group___l_e_d.html#ga20951fe9916766c41ee7e54a051de2eb">rc_led_set</a>(<a class="code" href="group___l_e_d.html#gga2f019f99f0f9379dd8a677d3f017baf4a0fe05d887f93787380fb76940ca52a58">RC_LED_GREEN</a>, 0);</div><div class="line">                        <a class="code" href="group___l_e_d.html#ga20951fe9916766c41ee7e54a051de2eb">rc_led_set</a>(<a class="code" href="group___l_e_d.html#gga2f019f99f0f9379dd8a677d3f017baf4acae9eba589c2aeeb09fa1f10dd7daed0">RC_LED_RED</a>, 1);</div><div class="line">                }</div><div class="line">                <span class="comment">// always sleep at some point</span></div><div class="line">                <a class="code" href="group__time.html#ga5477dde3014bc26b5ae6f0c773a8a340">rc_usleep</a>(100000);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// turn off LEDs and close file descriptors</span></div><div class="line">        <a class="code" href="group___l_e_d.html#ga20951fe9916766c41ee7e54a051de2eb">rc_led_set</a>(<a class="code" href="group___l_e_d.html#gga2f019f99f0f9379dd8a677d3f017baf4a0fe05d887f93787380fb76940ca52a58">RC_LED_GREEN</a>, 0);</div><div class="line">        <a class="code" href="group___l_e_d.html#ga20951fe9916766c41ee7e54a051de2eb">rc_led_set</a>(<a class="code" href="group___l_e_d.html#gga2f019f99f0f9379dd8a677d3f017baf4acae9eba589c2aeeb09fa1f10dd7daed0">RC_LED_RED</a>, 0);</div><div class="line">        <a class="code" href="group___l_e_d.html#gabe4fe5d68e716e8557ba2b349a374abe">rc_led_cleanup</a>();</div><div class="line">        <a class="code" href="group___button.html#gac178ded5fabaffbfcafe5ba0af1a986f">rc_button_cleanup</a>();    <span class="comment">// stop button handlers</span></div><div class="line">        <a class="code" href="group__start__stop.html#ga0f06d321e00e3963aa0d672ab0d06fe5">rc_remove_pid_file</a>();   <span class="comment">// remove pid file LAST</span></div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Make the Pause button toggle between paused and running states.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> on_pause_release()</div><div class="line">{</div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="group__start__stop.html#ga08307c9805692eb084112cbcae4b744f">rc_get_state</a>()==<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a>)     <a class="code" href="group__start__stop.html#ga693e5b9f051bb14507d1d9eb246f616e">rc_set_state</a>(<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9ad4bb05915de3c370d3a33d4f51389655">PAUSED</a>);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="group__start__stop.html#ga08307c9805692eb084112cbcae4b744f">rc_get_state</a>()==<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9ad4bb05915de3c370d3a33d4f51389655">PAUSED</a>) <a class="code" href="group__start__stop.html#ga693e5b9f051bb14507d1d9eb246f616e">rc_set_state</a>(<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* If the user holds the pause button for 2 seconds, set state to EXITING which</span></div><div class="line"><span class="comment">* triggers the rest of the program to exit cleanly.</span></div><div class="line"><span class="comment">**/</span></div><div class="line"><span class="keywordtype">void</span> on_pause_press()</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> samples = 100; <span class="comment">// check for release 100 times in this period</span></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> us_wait = 2000000; <span class="comment">// 2 seconds</span></div><div class="line"></div><div class="line">        <span class="comment">// now keep checking to see if the button is still held down</span></div><div class="line">        <span class="keywordflow">for</span>(i=0;i&lt;samples;i++){</div><div class="line">                <a class="code" href="group__time.html#ga5477dde3014bc26b5ae6f0c773a8a340">rc_usleep</a>(us_wait/samples);</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group___button.html#ga1df19b70e734eab3bbe12bffc113d352">rc_button_get_state</a>(<a class="code" href="group___button.html#ga113e5457cf1411e79c4d71bce30208f4">RC_BTN_PIN_PAUSE</a>)==<a class="code" href="group___button.html#gad0185157ad6d07de06974de1cb3dc7fc">RC_BTN_STATE_RELEASED</a>) <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line">        printf(<span class="stringliteral">&quot;long press detected, shutting down\n&quot;</span>);</div><div class="line">        <a class="code" href="group__start__stop.html#ga693e5b9f051bb14507d1d9eb246f616e">rc_set_state</a>(<a class="code" href="group__start__stop.html#ggac4ff093ea579df8514825b1e601d38f9acfb2a43c3a1dfa5961655a52e11c5d73">EXITING</a>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="manual.html">manual</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
